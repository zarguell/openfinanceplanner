---
phase: 15-state-management-persistence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/store/index.ts
  - src/store/types.ts
autonomous: true

must_haves:
  truths:
    - "Zustand package installed and type-safe"
    - "Store holds UserProfile state (nullable)"
    - "Store holds SimulationResult[] state (nullable)"
    - "Store provides actions to get/set/clear profile and projection"
    - "Store uses slice pattern for clean separation"
    - "Path alias @/store resolves correctly"
  artifacts:
    - path: "package.json"
      provides: "Zustand and idb-keyval dependencies"
      contains: '"zustand":'
    - path: "src/store/index.ts"
      provides: "Main Zustand store export"
      exports: ["useStore"]
      min_lines: 30
    - path: "src/store/types.ts"
      provides: "Store TypeScript interfaces"
      contains: "interface StoreState"
  key_links:
    - from: "src/store/index.ts"
      to: "@/core/types"
      via: "import UserProfile, SimulationResult"
      pattern: "from '@/core/types'"
    - from: "src/store/types.ts"
      to: "@/core/types"
      via: "type re-exports for store consumption"
      pattern: "export type .* from '@/core/types'"
---

<objective>
Create the Zustand store structure with slice pattern for user profile and projection state, establishing the global state management foundation.

Purpose: Phase 15 requires Zustand for state management (STATE-01). This plan installs dependencies and creates the core store structure with typed slices for profile and projection data.

Output: Zustand package installed, store directory with main store and types, slice-based state structure
</objective>

<execution_context>
@/Users/zach/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zach/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-state-management-persistence/15-RESEARCH.md
@.planning/phases/14-core-financial-engine/14-03-SUMMARY.md
@src/core/types/index.ts
@src/core/projection/index.ts
</context>

<tasks>

<task type="auto">
  <name>Install Zustand and idb-keyval dependencies</name>
  <files>package.json</files>
  <action>
    Install zustand (^5.0.0) and idb-keyval (^6.2.0) packages:
    1. Run: npm install zustand idb-keyval
    2. Run: npm install --save-dev @types/idb-keyval
    3. Verify packages appear in dependencies
    4. Run: npm run type-check to verify TypeScript types resolve

    Do NOT modify any other dependencies. This is a clean install following research recommendations.
  </action>
  <verify>grep -E '"zustand"|"idb-keyval"' package.json && npm run type-check</verify>
  <done>zustand and idb-keyval packages installed with TypeScript types, type-check passes</done>
</task>

<task type="auto">
  <name>Create store directory structure and types</name>
  <files>src/store/types.ts</files>
  <action>
    Create src/store/types.ts with TypeScript interfaces for the store:

    1. Import UserProfile and SimulationResult from @/core/types
    2. Define ProfileSlice interface with:
       - profile: UserProfile | null
       - setProfile: (profile: UserProfile) => void
       - clearProfile: () => void
    3. Define ProjectionSlice interface with:
       - projection: SimulationResult[] | null
       - setProjection: (projection: SimulationResult[]) => void
       - clearProjection: () => void
    4. Define HydrationSlice interface with:
       - _hasHydrated: boolean
       - setHasHydrated: (state: boolean) => void
    5. Export StoreState as union of all slices

    Follow slice pattern from research. Use readonly types from core, do not modify core types.
  </action>
  <verify>test -f src/store/types.ts && grep -q "interface.*Slice" src/store/types.ts && npm run type-check</verify>
  <done>Store types file exists with ProfileSlice, ProjectionSlice, and HydrationSlice interfaces</done>
</task>

<task type="auto">
  <name>Create main Zustand store with slices</name>
  <files>src/store/index.ts</files>
  <action>
    Create src/store/index.ts with the main Zustand store:

    1. Import create from zustand
    2. Import persist, createJSONStorage from zustand/middleware
    3. Import slice types from ./types
    4. Import UserProfile, SimulationResult from @/core/types
    5. Create useStore with create<StoreState>()
    6. Implement all slice actions:
       - profile: null
       - setProfile: (profile) => set({ profile })
       - clearProfile: () => set({ profile: null })
       - projection: null
       - setProjection: (projection) => set({ projection })
       - clearProjection: () => set({ projection: null })
       - _hasHydrated: false
       - setHasHydrated: (state) => set({ _hasHydrated: state })
    7. Export useStore as default

    Do NOT configure persist middleware yet (that's plan 15-02). This is the base store only.
    Use arrow functions for all setters to follow Zustand best practices.
  </action>
  <verify>test -f src/store/index.ts && grep -q "export const useStore" src/store/index.ts && npm run type-check</verify>
  <done>Main store file exists with useStore export, all slice actions implemented, no persist configured yet</done>
</task>

</tasks>

<verification>
Run npm run type-check to verify all TypeScript types resolve correctly. Verify store can be imported with @/store alias by checking import resolution in a test file.
</verification>

<success_criteria>
1. zustand and idb-keyval installed in package.json
2. src/store/ directory created with index.ts and types.ts
3. useStore exports with all slice actions (setProfile, clearProfile, setProjection, clearProjection, setHasHydrated)
4. TypeScript compiles without errors (npm run type-check passes)
5. @/store path alias resolves correctly
</success_criteria>

<output>
After completion, create `.planning/phases/15-state-management-persistence/15-01-SUMMARY.md`
</output>
