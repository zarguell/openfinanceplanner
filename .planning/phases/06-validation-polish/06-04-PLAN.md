---
phase: 06-validation-polish
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [eslint.config.js]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - 'ESLint reports zero errors for console and localStorage usage'
  artifacts:
    - path: 'eslint.config.js'
      provides: 'Browser globals for all files using console/localStorage'
      contains: 'globals.browser for src/**/rules/**/*.js, src/**/*.js'
  key_links:
    - from: 'eslint.config.js'
      to: 'src/**/*.js'
      via: 'browser globals configuration'
      pattern: 'globals.browser'
---

<objective>
Fix ESLint errors by adding browser globals (console, localStorage) to all files that use them.

Purpose: Phase 06-01 added browser globals only for src/ui/\*_/_.js, but 31 errors remain because console and localStorage are used in src/storage/, src/rules/, src/calculations/, and src/core/rules/ directories. This plan extends browser globals to all source files.
Output: Updated eslint.config.js with browser globals for all relevant directories, zero ESLint errors for console/localStorage usage.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/06-validation-polish/06-VERIFICATION.md
@.planning/phases/06-validation-polish/06-01-SUMMARY.md

# Gap being closed

ESLint reports 31 errors because browser globals (console, localStorage) are configured only for src/ui/\*_/_.js, but these globals are used in 20+ other files across:

- src/storage/StorageManager.js (localStorage, console)
- src/rules/RuleRegistry.js, RuleEngine.js, StrategyFactory.js (console, localStorage)
- src/rules/strategies/\*.js (console, localStorage)
- src/calculations/\*.js (console)
- src/core/rules/\*.js (console)

Current eslint.config.js (from 06-01):

- Line 29-36: Browser globals only for src/ui/\*_/_.js
- Missing: Browser globals for src/storage/**, src/rules/**, src/calculations/**, src/core/rules/**
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add browser globals to ESLint config for all source files</name>
  <files>eslint.config.js</files>
  <action>
  Extend browser globals configuration to cover all files that use console and localStorage:

1. Read current eslint.config.js (existing config for src/ui/\*_/_.js on lines 29-36)
2. Add new configuration block after line 36 for src/storage/\*_/_.js with globals.browser
3. Add new configuration block for src/rules/\*_/_.js with globals.browser
4. Add new configuration block for src/calculations/\*_/_.js with globals.browser
5. Add new configuration block for src/core/rules/\*_/_.js with globals.browser

Pattern (follow existing structure):

```javascript
{
  files: ['src/storage/**/*.js'],
  languageOptions: {
    globals: {
      ...globals.browser,
    },
  },
},
```

Add configuration blocks in this order after src/ui/\*_/_.js:

- src/storage/\*_/_.js (localStorage, console)
- src/rules/\*_/_.js (console, localStorage)
- src/calculations/\*_/_.js (console)
- src/core/rules/\*_/_.js (console)

This resolves all 'console is not defined' and 'localStorage is not defined' errors.
</action>
<verify>npm run lint</verify>
<done>ESLint reports zero 'no-undef' errors for console and localStorage usage</done>
</task>

<task type="auto">
  <name>Task 2: Verify ESLint configuration covers all affected files</name>
  <files>eslint.config.js</files>
  <action>
  Run ESLint to verify no 'no-undef' errors remain for console/localStorage:

1. Run: npm run lint
2. Check output for remaining 'console is not defined' or 'localStorage is not defined' errors
3. If any remain, identify file path and add matching files pattern to eslint.config.js
4. Re-run npm run lint until no 'no-undef' errors for console/localStorage

Note: Warnings (unused variables) are acceptable, but errors must be zero.
</action>
<verify>npm run lint 2>&1 | grep -c "no-undef.\*'console' is not defined" || echo "0"</verify>
<done>ESLint reports zero 'console is not defined' and zero 'localStorage is not defined' errors</done>
</task>

</tasks>

<verification>
1. ESLint runs without 'no-undef' errors for console or localStorage
2. All source files using console.log or localStorage have browser globals configured
3. Test suite still passes (npm test)
</verification>

<success_criteria>

- eslint.config.js updated with browser globals for src/storage/, src/rules/, src/calculations/, src/core/rules/
- ESLint reports zero 'console is not defined' errors
- ESLint reports zero 'localStorage is not defined' errors
- All 308 tests still pass
- 31 no-undef errors eliminated
  </success_criteria>

<output>
After completion, create `.planning/phases/06-validation-polish/06-04-SUMMARY.md`
</output>
