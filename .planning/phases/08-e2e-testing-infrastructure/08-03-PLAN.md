---
phase: 08-e2e-testing-infrastructure
plan: 03
type: execute
wave: 3
depends_on: [08-02]
files_modified: [.github/workflows/ci.yml]
autonomous: true
must_haves:
  truths:
    - GitHub Actions workflow runs E2E tests successfully in CI environment
    - Playwright browsers are properly installed in CI environment
    - E2E infrastructure works in CI with headless browser execution
    - Smoke test passes in CI validating the complete pipeline
  artifacts:
    - path: '.github/workflows/ci.yml'
      provides: 'CI workflow configuration for E2E tests'
      contains: 'npm run test:e2e'
    - path: '.github/workflows/ci.yml'
      provides: 'Proper Playwright browser installation'
      contains: 'playwright.*install'
  key_links:
    - from: '.github/workflows/ci.yml'
      to: 'E2E test execution'
      via: 'npm run test:e2e command'
      pattern: 'npm run test:e2e'
    - from: '.github/workflows/ci.yml'
      to: 'Playwright browser installation'
      via: 'Install step'
      pattern: 'playwright.*install'
---

<objective>
Configure CI workflow for E2E tests and verify the complete E2E testing infrastructure works in both local and CI environments.

Purpose: Ensure E2E tests run reliably in both local development and CI/CD environments by properly configuring GitHub Actions workflow with Playwright browser installation and verifying that the smoke test passes. This establishes a robust foundation for catching regressions early.
Output: Working CI configuration with E2E tests passing in GitHub Actions and improved local testing capabilities
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-e2e-testing-infrastructure/08-CONTEXT.md
@.planning/phases/08-e2e-testing-infrastructure/08-RESEARCH.md
@.planning/phases/08-e2e-testing-infrastructure/08-01-SUMMARY.md
@.planning/phases/08-e2e-testing-infrastructure/08-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update GitHub Actions Workflow for E2E Tests</name>
  <files>.github/workflows/ci.yml</files>
  <action>
    Update the existing GitHub Actions CI workflow to include E2E tests with proper Playwright configuration:
    
    1. Add Playwright installation step using official action to ensure browsers are properly installed in CI environment
    2. Add a step to run E2E tests after the existing lint and unit test steps
    3. Configure appropriate environment for browser testing in CI
    
    The workflow should:
    - Use the same Node.js version as existing steps (Node 20)
    - Install dependencies including the new E2E testing packages
    - Use playwright/actions/install-playwright action to install browsers
    - Run E2E tests using the npm run test:e2e script
    - Set appropriate timeout for browser-based tests (at least 10 minutes)
    
    The updated workflow should include:
    ```yaml
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps chromium
      
    - name: Run E2E tests
      run: npm run test:e2e
    ```
    
    Additional considerations for CI environment:
    - Ubuntu runner already has most dependencies needed for Playwright
    - Chromium is sufficient as per CONTEXT.md decisions (not all browsers needed)
    - Headless mode is appropriate for CI execution
  </action>
  <verify>
    .github/workflows/ci.yml includes steps to run E2E tests
    Workflow uses npm run test:e2e command
    Playwright browsers properly installed in CI environment using official action
    Workflow runs successfully when executed
  </verify>
  <done>
    GitHub Actions workflow updated to run E2E tests with proper Playwright setup
    Playwright browsers properly configured for CI with official installation action
    Workflow executes E2E tests as part of CI process with adequate timeouts
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance Smoke Test to Validate Application Functionality</name>
  <files>tests/e2e/smoke.test.js, tests/e2e/pages/AppPage.js</files>
  <action>
    Improve the smoke test to actually test the application functionality rather than just pass trivially:
    
    1. Update tests/e2e/smoke.test.js to create a real plan through the UI and verify it exists
    2. Create tests/e2e/pages/AppPage.js with methods for interacting with the application
    3. Use proper selectors that follow best practices from research (data-testid attributes)
    
    The enhanced smoke test should:
    - Start a local server to serve the application (port 3030)
    - Navigate to the application homepage
    - Create a new plan with a unique name
    - Verify the plan appears in the plan list
    - Demonstrate the full pipeline: browser → app → localStorage → verification
    
    The AppPage class should include:
    - Constructor that takes a page object
    - Methods for common interactions (createPlan, isPlanInList, etc.)
    - Proper error handling and waits for elements
    - Resilient selectors using data-testid attributes
    
    Example implementation:
    ```javascript
    import { test, expect } from 'vitest';
    import { AppPage } from './pages/AppPage.js';
    
    test('should create a plan via browser automation and verify it exists', async ({ page }) => {
      const appPage = new AppPage(page);
      const planName = 'Test Plan ' + Date.now(); // Unique name
      
      // Create a plan through the UI
      await appPage.createPlan(planName);
      
      // Verify the plan exists in the list
      const planExists = await appPage.isPlanInList(planName);
      expect(planExists).toBe(true);
    });
    ```
  </action>
  <verify>
    tests/e2e/smoke.test.js contains a real test that interacts with the application
    tests/e2e/pages/AppPage.js exists with proper page object implementation
    Test uses browser automation to create a plan and verify its existence
    Test follows best practices for selector strategies with data-testid attributes
  </verify>
  <done>
    Smoke test enhanced to validate actual application functionality
    AppPage class provides robust page object functionality
    Test demonstrates full E2E pipeline from UI to localStorage
  </done>
</task>

<task type="auto">
  <name>Task 3: Add E2E Test Script and Verify Local Infrastructure</name>
  <files>package.json</files>
  <action>
    Add the missing E2E test scripts to package.json as specified in requirement E2E-06:
    
    1. Add "test:e2e" script that runs E2E tests in headless mode
    2. Add "test:e2e:ui" script that launches the interactive test debugging UI
    3. Add "test:e2e:debug" script that runs tests in debug mode with browser visible
    
    The scripts should:
    - Use vitest with appropriate flags for browser testing
    - Specify the E2E project if multiple projects are configured
    - Use proper browser flags for headless vs headed modes
    
    Example script structure:
    ```json
    {
      "scripts": {
        "test:e2e": "vitest run --project e2e",
        "test:e2e:ui": "vitest --project e2e --ui",
        "test:e2e:debug": "vitest --project e2e --browser.headless false"
      }
    }
    ```
    
    Ensure the script names exactly match what's required in the roadmap success criteria.
  </action>
  <verify>
    package.json contains test:e2e, test:e2e:ui, and test:e2e:debug scripts
    Scripts use correct vitest commands with browser flags
    npm run test:e2e executes without errors
  </verify>
  <done>
    All three E2E test scripts added to package.json
    Scripts follow the naming convention specified in requirements
    Commands are properly configured for Vitest Browser Mode
  </done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 4: Verify E2E Testing Infrastructure Works in CI and Locally</name>
  <what-built>
    Complete E2E testing infrastructure including:
    1. Installed Vitest Browser Mode with Playwright provider
    2. Configured Vitest for browser testing with E2E project
    3. Added E2E test scripts (test:e2e, test:e2e:ui, test:e2e:debug)
    4. Enhanced smoke test that creates a plan via browser automation and verifies it exists
    5. Updated GitHub Actions workflow to run E2E tests in CI with proper Playwright setup
    6. Created AppPage class for robust page object pattern
  </what-built>
  <how-to-verify>
    LOCAL VERIFICATION:
    1. Run `npm run test:e2e` and verify the smoke test passes in headless browser
    2. Run `npm run test:e2e:ui` and verify the interactive UI launches correctly
    3. Run `npm run test:e2e:debug` and verify tests run with browser visible
    4. Check that vitest.config.js includes E2E project with Playwright provider
    5. Verify that tests/e2e/smoke.test.js creates a plan and verifies it exists
    6. Confirm AppPage class provides reusable methods for app interactions
    
    CI VERIFICATION:
    7. Check that .github/workflows/ci.yml includes E2E test execution with Playwright installation
    8. Manually trigger a workflow run or push a test commit to verify CI execution
    9. Confirm all requirements from ROADMAP.md are met:
       - E2E-01: Install Vitest Browser Mode with Playwright provider ✓
       - E2E-02: Configure E2E test environment (vitest.config.js, playwright config) ✓
       - E2E-06: Add test scripts (test:e2e, test:e2e:ui, test:e2e:debug) ✓
    
    SUCCESS CRITERIA VERIFICATION:
    1. Developer can run `npm run test:e2e` and see one smoke test pass in browser
    2. Vitest config includes E2E project with Playwright provider configured
    3. Playwright browsers installed (chromium, firefox, webkit)
    4. Smoke test creates a plan via browser automation and verifies it exists
    5. `npm run test:e2e:ui` launches interactive test debugging UI
  </how-to-verify>
  <resume-signal>
    Type "approved" or describe any issues that need to be addressed
  </resume-signal>
</task>

</tasks>

<verification>
1. GitHub Actions workflow updated to run E2E tests with proper Playwright setup
2. All E2E test scripts functional (test:e2e, test:e2e:ui, test:e2e:debug)
3. Smoke test passes in both local and CI environments with real application testing
4. AppPage class provides robust page object functionality
5. Playwright browsers properly installed and configured in CI environment
6. All requirements from roadmap satisfied
</verification>

<success_criteria>

1. Developer can run `npm run test:e2e` and see one smoke test pass in browser
2. Vitest config includes E2E project with Playwright provider configured
3. Playwright browsers installed (chromium, firefox, webkit)
4. Smoke test creates a plan via browser automation and verifies it exists
5. `npm run test:e2e:ui` launches interactive test debugging UI
6. GitHub Actions workflow runs E2E tests successfully with proper Playwright setup
7. AppPage class provides reusable methods for robust E2E testing
   </success_criteria>

<output>
After completion, create `.planning/phases/08-e2e-testing-infrastructure/08-03-SUMMARY.md`
</output>
