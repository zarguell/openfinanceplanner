---
phase: 13-architecture-testing-foundation
plan: 05
type: execute
wave: 3
depends_on: [13-03]
files_modified:
  - package.json
  - src/core/utils/example.test.ts
  - src/core/utils/example.ts
  - coverage/index.html
  - coverage/coverage-final.json
autonomous: true

must_haves:
  truths:
    - 'npm run test:ui opens Vitest UI in browser'
    - 'npm run test:coverage generates coverage report with v8 provider'
    - 'Example test demonstrates TDD workflow foundation'
    - 'All test scripts (test, test:ui, test:coverage) execute successfully'
  artifacts:
    - path: 'package.json'
      provides: 'Test scripts and Vitest dependencies'
      contains: ['"test"', '"test:ui"', '"test:coverage"']
    - path: 'src/core/utils/example.test.ts'
      provides: 'Example test demonstrating TDD workflow'
      contains: ['describe', 'it', 'expect']
    - path: 'coverage/index.html'
      provides: 'HTML coverage report generated by v8 provider'
      contains: ['coverage']
  key_links:
    - from: 'package.json'
      to: 'vitest.config.ts'
      via: 'test script configuration'
      pattern: "\"test\":\\s*\"vitest\""
    - from: '*.test.ts'
      to: 'vitest.config.ts'
      via: 'include pattern matching'
      pattern: 'include.*test'
---

<objective>
Add test scripts, create example test demonstrating TDD workflow, and verify coverage reporting.

Purpose: Completes the test infrastructure setup by adding convenient npm scripts and demonstrating that the entire TDD workflow (test, UI mode, coverage) works. This creates the foundation for Phase 14 TDD development of the Core Financial Engine.

Output: Working test scripts (test, test:ui, test:coverage), passing example test, verified coverage report.
</objective>

<execution_context>
@/Users/zach/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zach/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/13-architecture-testing-foundation/13-RESEARCH.md
@.planning/phases/13-architecture-testing-foundation/13-03-SUMMARY.md

Research reference: Common Pitfalls (test script configuration, coverage verification).
</context>

<tasks>

<task type="auto">
  <name>Add test scripts to package.json</name>
  <files>
    package.json
  </files>
  <action>
    Add test scripts to package.json scripts section:

    ```json
    "scripts": {
      "dev": "vite",
      "build": "tsc && vite build",
      "preview": "vite preview",
      "test": "vitest",
      "test:ui": "vitest --ui",
      "test:coverage": "vitest --coverage",
      "lint": "eslint .",
      "lint:fix": "eslint . --fix",
      "format": "prettier --write .",
      "format:check": "prettier --check .",
      "type-check": "tsc --noEmit"
    }
    ```

    Add test, test:ui, and test:coverage scripts.
    Keep existing scripts from previous plans (dev, build, preview, lint, format, type-check).

    DO NOT modify existing scripts.

  </action>
  <verify>
    ```bash
    npm run test -- --run
    ```
    Should run Vitest in single-run mode (watch mode disabled by --run flag).
  </verify>
  <done>
    package.json has test, test:ui, and test:coverage scripts. All test commands execute successfully.
  </done>
</task>

<task type="auto">
  <name>Create example test and implementation</name>
  <files>
    src/core/utils/example.ts
    src/core/utils/example.test.ts
  </files>
  <action>
    Create src/core/utils/example.ts and example.test.ts:

    src/core/utils/example.ts:
    ```typescript
    /**
     * Example utility function to demonstrate test infrastructure.
     *
     * This file can be deleted after verifying tests work.
     * Phase 14 will replace this with actual financial calculation utilities.
     */

    export function add(a: number, b: number): number {
      return a + b
    }
    ```

    src/core/utils/example.test.ts:
    ```typescript
    import { describe, it, expect } from 'vitest'
    import { add } from './example'

    describe('add', () => {
      it('should add two positive numbers correctly', () => {
        expect(add(1, 2)).toBe(3)
      })

      it('should handle zero', () => {
        expect(add(0, 0)).toBe(0)
      })

      it('should handle negative numbers', () => {
        expect(add(-1, -2)).toBe(-3)
      })

      it('should handle mixed positive and negative', () => {
        expect(add(5, -3)).toBe(2)
      })
    })
    ```

    This example test:
    - Demonstrates global test APIs work (describe, it, expect available without imports in test files)
    - Shows TDD workflow foundation (can write tests before implementation)
    - Validates Vitest configuration is correct
    - Uses pure TypeScript function (no React dependencies)

    Run the tests to verify everything works:

    ```bash
    npm run test -- --run
    ```

  </action>
  <verify>
    ```bash
    npm run test -- --run
    ```
    Should show 4 passing tests for the add function.
  </verify>
  <done>
    Example test file created and all 4 tests pass. Test infrastructure verified working.
  </done>
</task>

<task type="auto">
  <name>Verify coverage and test UI work</name>
  <files>
    coverage/index.html
    coverage/coverage-final.json
  </files>
  <action>
    Run coverage to verify the v8 provider works:

    ```bash
    npm run test:coverage
    ```

    This should:
    1. Run all tests
    2. Generate coverage report using v8 provider
    3. Create coverage/ directory with:
       - coverage/index.html - HTML coverage report
       - coverage/coverage-final.json - JSON coverage data
       - coverage/ - Text summary in terminal

    Verify the coverage directory was created:

    ```bash
    ls -la coverage/
    ```

    Optionally, verify test UI works (opens in browser):

    ```bash
    npm run test:ui -- --run
    ```

    Press Ctrl+C to close the UI when verified.

    DO NOT proceed if coverage fails - this indicates v8 provider configuration issue.

  </action>
  <verify>
    ```bash
    ls -la coverage/
    cat coverage/index.html | head -20
    ```
    coverage/ directory should exist with index.html and coverage-final.json.
  </verify>
  <done>
    npm run test:coverage completes successfully, coverage/ directory created with HTML and JSON reports. Test UI opens in browser.
  </done>
</task>

</tasks>

<verification>
Overall Phase 13 Verification (after all plans complete):

1. Run `npm run test` - verify Vitest runs in watch mode
2. Run `npm run test:coverage` - verify coverage report generates
3. Run `npm run test:ui` - verify UI mode works (opens browser)
4. Verify example tests pass (4 tests in src/core/utils/example.test.ts)
   </verification>

<success_criteria>

1. `npm run test` runs Vitest with global test APIs (describe, it, expect available without imports)
2. `npm run test:ui` opens Vitest UI in browser
3. `npm run test:coverage` generates coverage report with v8 provider (not istanbul)
4. Example test (src/core/utils/example.test.ts) passes all 4 tests
5. Test files use .test.ts or .spec.ts naming convention and are discovered by Vitest
6. coverage/ directory exists with HTML and JSON reports
   </success_criteria>

<output>
After completion, create `.planning/phases/13-architecture-testing-foundation/13-05-SUMMARY.md` with:
- Test scripts configuration
- Confirmation that example tests pass
- Coverage report verification
- Test UI confirmation
</output>
