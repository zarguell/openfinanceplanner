---
phase: 18-pwa-offline-capability
plan: '03'
type: execute
wave: 3
depends_on: ['18-02']
files_modified:
  ['src/main.tsx', 'src/App.tsx', 'src/components/PWAProvider.tsx']
autonomous: false
user_setup: []
must_haves:
  truths:
    - 'PWA functionality is integrated into the main application'
    - 'Users can install the app on supported devices'
    - 'Users are notified when new versions are available'
    - 'App functions completely offline after first visit'
  artifacts:
    - path: 'src/main.tsx'
      provides: 'PWA provider integration'
      contains: 'PWAProvider'
    - path: 'src/App.tsx'
      provides: 'Install prompt and update notice integration'
      contains: 'PWAInstallPrompt|PWAUpdateNotice'
  key_links:
    - from: 'src/main.tsx'
      to: 'PWAProvider'
      via: 'component wrapper'
      pattern: '<PWAProvider>'
---

<objective>
Add install prompt handling and update notification workflow

Purpose: Complete PWA integration by adding install prompt handling and update notifications to the main application UI
Output: Fully functional PWA with install capability and update notifications
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-pwa-offline-capability/18-CONTEXT.md
@.planning/phases/18-pwa-offline-capability/18-RESEARCH.md
@.planning/phases/18-pwa-offline-capability/18-01-SUMMARY.md
@.planning/phases/18-pwa-offline-capability/18-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate PWA components into main application</name>
  <files>src/main.tsx, src/App.tsx</files>
  <action>Integrate the PWA components into the main application:
1. Update src/main.tsx to:
   - Import the PWAProvider component
   - Wrap the App component with PWAProvider (if created) or directly integrate service worker registration
2. Update src/App.tsx to:
   - Import PWAInstallPrompt and PWAUpdateNotice components
   - Add these components to the main App render function at the top level
   - Position PWAUpdateNotice at the top for visibility
   - Position PWAInstallPrompt appropriately in the UI (possibly in a header or as a floating element)
3. Ensure components work with the existing MantineProvider
4. Maintain existing application functionality while adding PWA features</action>
  <verify>npx vite build && npm run preview && check that PWA components are included in build</verify>
  <done>PWA components are integrated into main application and build process</done>
</task>

<task type="auto">
  <name>Task 2: Create PWA provider component</name>
  <files>src/components/PWAProvider.tsx</files>
  <action>Create a provider component to manage PWA state at the application level:
1. Create PWAProvider.tsx that:
   - Uses the usePWA hook internally
   - Manages global PWA state (registration, updates, install prompts)
   - Provides context for PWA state to child components
   - Handles the beforeinstallprompt event globally
2. Define TypeScript interfaces for PWA context values
3. Implement the provider with proper React context
4. Export both the provider component and a useContext hook for accessing PWA state</action>
  <verify>Check that provider correctly manages PWA state and provides it to child components</verify>
  <done>PWAProvider component manages global PWA state and provides it via React context</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete PWA implementation with install prompts and update notifications</what-built>
  <how-to-verify>
1. Build the application: `npm run build`
2. Preview the build: `npm run preview`
3. Open the application in Chrome DevTools and check:
   - Application tab shows service worker is registered
   - Manifest is properly configured with name and icons
   - Offline checkbox works correctly (app functions when offline)
4. Check that install prompt appears on supported devices/browsers
5. Test update mechanism by making a small change, rebuilding, and verifying update notification appears
6. Confirm all PWA requirements are met:
   - App loads and functions 100% offline after first visit
   - User can install app on supported devices
   - User is notified when new version is available
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found during testing</resume-signal>
</task>

</tasks>

<verification>
- PWA provider correctly manages global PWA state
- Install prompt component integrates with application UI
- Update notification component displays properly
- Service worker registers and caches assets
- Application functions offline after first visit
- Install prompt appears on supported devices
- Update notifications appear when new versions are available
</verification>

<success_criteria>

- PWA provider manages all PWA functionality at application level
- Install prompt appears and works on supported browsers/devices
- Update notifications appear and function correctly
- Application passes all PWA requirements:
  1. Service worker registers and caches assets
  2. App functions 100% offline after first visit
  3. Install prompt appears on supported devices
  4. User notified when new version available
     </success_criteria>

<output>
After completion, create `.planning/phases/18-pwa-offline-capability/18-03-SUMMARY.md`
</output>
</file>
