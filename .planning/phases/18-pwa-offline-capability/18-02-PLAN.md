---
phase: 18-pwa-offline-capability
plan: '02'
type: execute
wave: 2
depends_on: ['18-01']
files_modified:
  [
    'src/hooks/usePWA.ts',
    'src/components/PWAInstallPrompt.tsx',
    'src/components/PWAUpdateNotice.tsx',
  ]
autonomous: true
user_setup: []
must_haves:
  truths:
    - 'Service worker is registered when the application starts'
    - 'Application can detect when it is ready to work offline'
    - 'Application can detect when new content is available'
  artifacts:
    - path: 'src/hooks/usePWA.ts'
      provides: 'Service worker registration hook'
      exports: 'useRegisterSW'
    - path: 'src/components/PWAInstallPrompt.tsx'
      provides: 'Install prompt UI component'
    - path: 'src/components/PWAUpdateNotice.tsx'
      provides: 'Update notification UI component'
  key_links:
    - from: 'src/main.tsx'
      to: 'useRegisterSW'
      via: 'import and hook call'
      pattern: "useRegisterSW\\("
---

<objective>
Implement service worker registration and offline asset caching

Purpose: Set up service worker registration with React hooks and implement offline caching for all application assets
Output: Registered service worker with offline capability for all static assets
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-pwa-offline-capability/18-CONTEXT.md
@.planning/phases/18-pwa-offline-capability/18-RESEARCH.md
@.planning/phases/18-pwa-offline-capability/18-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create service worker registration hook</name>
  <files>src/hooks/usePWA.ts</files>
  <action>Create a React hook for managing service worker registration using the virtual:pwa-register/react module:
1. Import useRegisterSW from 'virtual:pwa-register/react'
2. Create a custom hook that wraps useRegisterSW with:
   - onRegistered callback that logs registration
   - onRegisterError callback that logs errors
   - Proper state management for offlineReady and needRefresh flags
   - updateServiceWorker function for applying updates
3. Export the hook for use in components</action>
  <verify>npm run dev && check browser console for service worker registration messages</verify>
  <done>Custom hook created that properly registers service worker and manages update states</done>
</task>

<task type="auto">
  <name>Task 2: Implement install prompt component</name>
  <files>src/components/PWAInstallPrompt.tsx</files>
  <action>Create a component to handle PWA installation prompts:
1. Use the beforeinstallprompt event to capture install prompts
2. Create a component that:
   - Listens for the beforeinstallprompt event
   - Stores the event for later use
   - Provides a button to trigger the install prompt
   - Handles user acceptance/rejection of the install prompt
   - Removes the prompt after use
3. Style the component with Mantine UI components
4. Add proper TypeScript types for the beforeinstallprompt event</action>
  <verify>Check that component renders correctly and handles install prompt events</verify>
  <done>Component properly captures and triggers PWA installation when supported</done>
</task>

<task type="auto">
  <name>Task 3: Create update notification component</name>
  <files>src/components/PWAUpdateNotice.tsx</files>
  <action>Create a component to notify users of available updates:
1. Use the usePWA hook (created in Task 1) to access:
   - needRefresh state
   - offlineReady state
   - updateServiceWorker function
2. Create a notification component that:
   - Shows when offlineReady is true ("App ready to work offline")
   - Shows when needRefresh is true ("New content available, click reload to update.")
   - Provides buttons to reload (update) or close the notification
   - Automatically hides after user interaction
3. Style with Mantine UI components for consistency</action>
  <verify>Check that component displays correctly when service worker states change</verify>
  <done>Component displays appropriate notifications for offline readiness and available updates</done>
</task>

</tasks>

<verification>
- Service worker registers successfully on application start
- Application can detect offline readiness
- Application can detect when updates are available
- Install prompt component captures and triggers PWA installation
- Update notification component displays appropriate messages
</verification>

<success_criteria>

- Service worker is registered without errors
- OfflineReady state is properly detected and communicated to user
- NeedRefresh state is properly detected and update mechanism works
- Install prompt component captures beforeinstallprompt events
- Update notice component displays appropriate notifications
  </success_criteria>

<output>
After completion, create `.planning/phases/18-pwa-offline-capability/18-02-SUMMARY.md`
</output>
</file>
