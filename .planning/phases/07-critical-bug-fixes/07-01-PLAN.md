---
phase: 07-critical-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/calculations/monte-carlo.js
autonomous: true

must_haves:
  truths:
    - 'Monte Carlo module exports expected functions (runMonteCarloSimulation, getSuccessProbabilityWithConfidence)'
    - 'File has 171 lines (original implementation)'
    - 'ESLint passes with zero errors'
    - 'No other files were accidentally deleted in Phase 1'
  artifacts:
    - path: 'src/calculations/monte-carlo.js'
      provides: 'Monte Carlo simulation implementation'
      min_lines: 171
      exports:
        [
          'runMonteCarloSimulation',
          'getSuccessProbabilityWithConfidence',
          'runMonteCarloScenario',
          'generateRandomReturn',
          'analyzeSequenceOfReturnsRisk',
        ]
  key_links:
    - from: 'src/ui/ProjectionController.js'
      to: 'src/calculations/monte-carlo.js'
      via: 'import statement'
      pattern: 'from.*monte-carlo'
---

<objective>
Restore the accidentally deleted Monte Carlo implementation from git history, resolving the module import failure that breaks the entire application.

Purpose: This is the root cause fix - the Monte Carlo module was accidentally emptied in Phase 1 (commit d72c351), causing a cascade of failures (ProjectionController imports fail, window.app never initializes, onclick handlers broken).

Output: Restored monte-carlo.js with 171 lines, all expected exports present, ESLint passing, verified no other files were deleted.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/07-critical-bug-fixes/07-RESEARCH.md

# Git history for reference

git show 9d7b704:src/calculations/monte-carlo.js # Original implementation (171 lines)
git show d72c351:src/calculations/monte-carlo.js # Empty file (commit where deletion happened)
</context>

<tasks>

<task type="auto">
  <name>Restore Monte Carlo Implementation from Git History</name>
  <files>src/calculations/monte-carlo.js</files>
  <action>
    1. View original implementation to verify content: `git show 9d7b704:src/calculations/monte-carlo.js`
    2. Review the 171-line implementation (should contain: generateRandomReturn, runMonteCarloScenario, runMonteCarloSimulation, getSuccessProbabilityWithConfidence, analyzeSequenceOfReturnsRisk)
    3. Restore file: `git show 9d7b704:src/calculations/monte-carlo.js > src/calculations/monte-carlo.js`
    4. Verify restoration: `wc -l src/calculations/monte-carlo.js` (should be 171)
    5. Check for other deleted files from Phase 1: `git diff 9d7b704..HEAD --name-status | grep "^D"` (should be empty or none unexpected)
    6. Run linter: `npm run lint` (should pass with zero errors)
    7. Stage and commit: `git add src/calculations/monte-carlo.js && git commit -m "fix(BUGFIX-01): restore accidentally deleted Monte Carlo implementation (171 lines from commit 9d7b704)"`
  </action>
  <verify>
    1. `wc -l src/calculations/monte-carlo.js` → 171
    2. `grep "export.*runMonteCarloSimulation" src/calculations/monte-carlo.js` → found
    3. `grep "export.*getSuccessProbabilityWithConfidence" src/calculations/monte-carlo.js` → found
    4. `npm run lint` → zero errors
    5. `git diff 9d7b704..HEAD --name-status | grep "^D"` → no unexpected deletions
  </verify>
  <done>
    Monte Carlo implementation restored (171 lines), all expected exports present (runMonteCarloSimulation, getSuccessProbabilityWithConfidence, etc.), ESLint passes, no other files accidentally deleted.
  </done>
</task>

</tasks>

<verification>
- File has 171 lines (verified with wc -l)
- Exports all 5 functions: runMonteCarloSimulation, getSuccessProbabilityWithConfidence, runMonteCarloScenario, generateRandomReturn, analyzeSequenceOfReturnsRisk
- ESLint passes with zero errors
- No other files were accidentally deleted (verified with git diff)
</verification>

<success_criteria>

1. src/calculations/monte-carlo.js has 171 lines
2. All expected exports are present (verified with grep)
3. npm run lint passes with zero errors
4. Git history confirms restoration from commit 9d7b704
   </success_criteria>

<output>
After completion, create `.planning/phases/07-critical-bug-fixes/07-01-SUMMARY.md`
</output>
