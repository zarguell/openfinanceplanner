---
phase: 17-data-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/chart.ts
  - src/hooks/useChartData.ts
  - src/components/charts/ResponsiveChartWrapper.tsx
  - src/components/charts/index.ts
autonomous: true

must_haves:
  truths:
    - 'Recharts library is installed and available in the project'
    - 'Chart data hook transforms simulation results to chart-ready format'
    - 'ResponsiveContainer wrapper handles parent sizing correctly'
    - 'Type definitions exist for all chart data structures'
  artifacts:
    - path: 'src/types/chart.ts'
      provides: 'ChartData type and related type definitions'
      exports: ['ChartData', 'ChartSeries']
    - path: 'src/hooks/useChartData.ts'
      provides: 'Hook to transform simulation results to chart data'
      exports: ['useChartData']
    - path: 'src/components/charts/ResponsiveChartWrapper.tsx'
      provides: 'Wrapper component ensuring ResponsiveContainer has proper parent dimensions'
      exports: ['ResponsiveChartWrapper']
  key_links:
    - from: 'src/hooks/useChartData.ts'
      to: 'src/stores/simulation'
      via: 'useSimulationStore selector'
      pattern: 'useSimulationStore.*result'
    - from: 'src/components/charts/ResponsiveChartWrapper.tsx'
      to: 'recharts/ResponsiveContainer'
      via: 'import and render'
      pattern: 'import.*ResponsiveContainer'
---

<objective>
Install Recharts and create the foundational infrastructure for data visualization: type definitions, data transformation hook, and a ResponsiveContainer wrapper that handles mobile sizing correctly.

Purpose: Provides the base layer that all chart components will build upon. Without proper types and responsive sizing, charts will fail on mobile or cause runtime errors.
Output: Recharts dependency, chart types, useChartData hook, and ResponsiveChartWrapper component
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-data-visualization/17-RESEARCH.md

## Core Types Available

The following types exist in the codebase from Phase 14:

```typescript
// From src/core/types.ts (or similar)
interface UserProfile {
  currentAge: number;
  currentSavings: number;
  annualGrowthRate: number;
  annualSpending: number;
  targetAge: number;
}

interface SimulationResult {
  projections: Array<{
    year: number;
    age: number;
    startingBalance: number;
    growth: number;
    spending: number;
    endingBalance: number;
  }>;
}
```

## Zustand Store Pattern

The simulation store from Phase 15 uses this pattern:

```typescript
import { useSimulationStore } from '@/stores/simulation';

const result = useSimulationStore((state) => state.result);
```

## Research Key Points

From 17-RESEARCH.md:

- Recharts 3.x is the standard (npm install recharts)
- ResponsiveContainer requires parent with explicit dimensions
- Use useMemo for data transformation to prevent re-renders
- Pattern: Create wrapper component that ensures parent has height/width
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts dependency</name>
  <files>package.json, package-lock.json</files>
  <action>
    Install Recharts 3.x using npm:
    ```bash
    npm install recharts
    ```
    
    Verify installation by checking package.json includes "recharts": "^3.0.0" or similar.
    No additional packages are required for core functionality.
  </action>
  <verify>Run `npm list recharts` and confirm version 3.x is installed</verify>
  <done>Recharts 3.x is listed in dependencies and node_modules/recharts exists</done>
</task>

<task type="auto">
  <name>Task 2: Create chart type definitions</name>
  <files>src/types/chart.ts</files>
  <action>
    Create src/types/chart.ts with types for chart data:

    ```typescript
    /**
     * Data point for a single year in chart visualization
     */
    export interface ChartDataPoint {
      year: number;
      age: number;
      netWorth: number;
      startingBalance: number;
      growth: number;
      spending: number;
      endingBalance: number;
    }

    /**
     * Complete chart dataset derived from simulation result
     */
    export interface ChartData {
      points: ChartDataPoint[];
      minNetWorth: number;
      maxNetWorth: number;
      years: number;
    }

    /**
     * Configuration for a data series in multi-series charts
     */
    export interface ChartSeries {
      key: keyof ChartDataPoint;
      name: string;
      color: string;
    }
    ```

    These types map the simulation result format to chart-friendly structure.

  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Chart types file exists with ChartDataPoint, ChartData, and ChartSeries interfaces</done>
</task>

<task type="auto">
  <name>Task 3: Create useChartData hook</name>
  <files>src/hooks/useChartData.ts</files>
  <action>
    Create src/hooks/useChartData.ts that transforms simulation results to chart data:

    ```typescript
    import { useMemo } from 'react';
    import { useSimulationStore } from '@/stores/simulation';
    import type { ChartData, ChartDataPoint } from '@/types/chart';

    export function useChartData(): ChartData {
      const simulationResult = useSimulationStore((state) => state.result);

      return useMemo(() => {
        if (!simulationResult?.projections || simulationResult.projections.length === 0) {
          return {
            points: [],
            minNetWorth: 0,
            maxNetWorth: 0,
            years: 0,
          };
        }

        const points: ChartDataPoint[] = simulationResult.projections.map((projection) => ({
          year: projection.year,
          age: projection.age,
          netWorth: projection.endingBalance,
          startingBalance: projection.startingBalance,
          growth: projection.growth,
          spending: projection.spending,
          endingBalance: projection.endingBalance,
        }));

        const netWorths = points.map((p) => p.netWorth);
        const minNetWorth = Math.min(...netWorths);
        const maxNetWorth = Math.max(...netWorths);

        return {
          points,
          minNetWorth,
          maxNetWorth,
          years: points.length,
        };
      }, [simulationResult]);
    }
    ```

    Key requirements from research:
    - Use useMemo to prevent unnecessary re-renders
    - Handle empty/undefined results gracefully
    - Select only needed state from Zustand (result only)

  </action>
  <verify>Create a test file and verify hook returns correct ChartData structure with mock store</verify>
  <done>Hook exists, transforms projections to chart points, uses useMemo, handles empty results</done>
</task>

<task type="auto">
  <name>Task 4: Create ResponsiveChartWrapper component</name>
  <files>src/components/charts/ResponsiveChartWrapper.tsx, src/components/charts/index.ts</files>
  <action>
    Create src/components/charts/ResponsiveChartWrapper.tsx:

    ```typescript
    import { type ReactNode } from 'react';
    import { ResponsiveContainer } from 'recharts';
    import { Box } from '@mantine/core';

    interface ResponsiveChartWrapperProps {
      children: ReactNode;
      height?: number;
      minHeight?: number;
      debounce?: number;
    }

    /**
     * Wrapper component that ensures ResponsiveContainer has proper parent dimensions.
     *
     * CRITICAL: ResponsiveContainer requires parent with explicit dimensions.
     * This component uses Mantine's Box with defined height to satisfy that requirement.
     *
     * From 17-RESEARCH.md Pattern 1:
     * - Parent element MUST have explicit or percentage-based dimensions
     * - ResponsiveContainer cannot be used inside flex container without explicit sizing
     */
    export function ResponsiveChartWrapper({
      children,
      height = 300,
      minHeight = 200,
      debounce = 200, // Debounce resize calculations for mobile performance
    }: ResponsiveChartWrapperProps) {
      return (
        <Box style={{ width: '100%', height, minHeight }}>
          <ResponsiveContainer width="100%" height="100%" debounce={debounce}>
            {children}
          </ResponsiveContainer>
        </Box>
      );
    }
    ```

    Also create src/components/charts/index.ts:
    ```typescript
    export { ResponsiveChartWrapper } from './ResponsiveChartWrapper';
    ```

    Key requirements:
    - Explicit height on parent (Box component)
    - Debounce prop for mobile orientation changes
    - Percentage width for responsiveness

  </action>
  <verify>Component renders without errors in a test file with mock children</verify>
  <done>Wrapper component exists with Box parent, ResponsiveContainer child, configurable height/debounce</done>
</task>

</tasks>

<verification>
1. Recharts is installed: `npm list recharts` shows version 3.x
2. Types compile: `npx tsc --noEmit` passes
3. Hook transforms data correctly: Run hook with mock simulation result
4. Wrapper provides proper parent dimensions: Check Box has height and minHeight styles
</verification>

<success_criteria>

- Recharts 3.x installed and available
- Chart types defined (ChartDataPoint, ChartData, ChartSeries)
- useChartData hook transforms simulation results to chart format with useMemo
- ResponsiveChartWrapper ensures ResponsiveContainer has proper parent dimensions
- All TypeScript compiles without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/17-data-visualization/17-01-SUMMARY.md`
</output>
