---
phase: 17-data-visualization
plan: 03
type: execute
wave: 2
depends_on: [17-01]
files_modified:
  - src/components/tables/ProjectionTable.tsx
  - src/components/tables/index.ts
autonomous: true

must_haves:
  truths:
    - 'Table displays all projection years with age, savings, growth, spending, balance'
    - 'Table updates automatically when simulation results change'
    - 'Table is responsive (readable on mobile screens)'
    - 'Currency values are properly formatted'
    - 'Table and chart show consistent data from same source'
  artifacts:
    - path: 'src/components/tables/ProjectionTable.tsx'
      provides: 'Year-by-year projection data table'
      exports: ['ProjectionTable']
      min_lines: 100
    - path: 'src/components/tables/index.ts'
      provides: 'Table components barrel export'
      exports: ['ProjectionTable']
  key_links:
    - from: 'src/components/tables/ProjectionTable.tsx'
      to: 'src/hooks/useChartData'
      via: 'useChartData() hook call'
      pattern: "const.*= useChartData\\(\\)"
    - from: 'src/components/tables/ProjectionTable.tsx'
      to: 'src/utils/currency.ts'
      via: 'formatCurrency import'
      pattern: 'formatCurrency'
    - from: 'src/components/tables/ProjectionTable.tsx'
      to: 'src/components/charts/NetWorthChart'
      via: 'same data source (useChartData)'
      pattern: "useChartData\\(\\)"
---

<objective>
Create a year-by-year data table that displays projection details (age, starting balance, growth, spending, ending balance) synchronized with the chart. The table uses Mantine's Table component with responsive styling.

Purpose: Provides detailed numerical view complementing the visual chart, allowing users to see exact values for any year.
Output: ProjectionTable component showing all projection years with formatted financial data
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/17-data-visualization/17-RESEARCH.md
@.planning/phases/17-data-visualization/17-01-SUMMARY.md
@.planning/phases/17-data-visualization/17-02-SUMMARY.md

## Dependencies Established

- useChartData hook from 17-01
- formatCurrency utility from 17-02
- ChartDataPoint type from src/types/chart.ts

## Mantine Table Component

Mantine v8 Table component available:

```tsx
import { Table } from '@mantine/core';

<Table>
  <Table.Thead>
    <Table.Tr>
      <Table.Th>Column</Table.Th>
    </Table.Tr>
  </Table.Thead>
  <Table.Tbody>
    <Table.Tr>
      <Table.Td>Value</Table.Td>
    </Table.Tr>
  </Table.Tbody>
</Table>;
```

## Mobile Responsiveness Approach

From UI requirements: Tables should display as cards on mobile (< 768px) and standard rows on desktop.

Approach options:

1. **Horizontal scroll** - Simplest, works for few columns
2. **Card layout on mobile** - Transform rows to cards below breakpoint
3. **Column selection** - Hide less critical columns on mobile

For this financial table (5 columns), horizontal scroll with sticky first column is acceptable and simpler than full card transformation.

## Data Synchronization

Table uses the SAME useChartData hook as the chart, ensuring both visualizations show identical data.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProjectionTable component structure</name>
  <files>src/components/tables/ProjectionTable.tsx</files>
  <action>
    Create src/components/tables/ProjectionTable.tsx with full table implementation:

    ```typescript
    import { useMemo } from 'react';
    import {
      Table,
      Paper,
      Text,
      ScrollArea,
      Badge,
    } from '@mantine/core';
    import { useChartData } from '@/hooks/useChartData';
    import { formatCurrency } from '@/utils/currency';

    interface TableRow {
      year: number;
      age: number;
      startingBalance: number;
      growth: number;
      spending: number;
      endingBalance: number;
      growthRate: number;
    }

    /**
     * Year-by-year projection data table.
     *
     * Features:
     * - Displays all projection years from simulation
     * - Shows age, starting balance, annual growth, spending, ending balance
     * - Highlights milestone years (e.g., retirement age)
     * - Responsive horizontal scroll on mobile
     * - Formatted currency values
     * - Synchronized with chart via useChartData hook
     */
    export function ProjectionTable() {
      const { points } = useChartData();

      const rows = useMemo<TableRow[]>(() => {
        return points.map((point, index) => {
          const prevPoint = index > 0 ? points[index - 1] : null;
          const growthRate = prevPoint
            ? ((point.netWorth - prevPoint.netWorth) / prevPoint.netWorth) * 100
            : 0;

          return {
            year: point.year,
            age: point.age,
            startingBalance: point.startingBalance,
            growth: point.growth,
            spending: point.spending,
            endingBalance: point.endingBalance,
            growthRate,
          };
        });
      }, [points]);

      // Empty state
      if (points.length === 0) {
        return (
          <Paper p="xl" ta="center" withBorder>
            <Text c="dimmed">Enter your financial details to see year-by-year projections</Text>
          </Paper>
        );
      }

      return (
        <Paper p="md" withBorder radius="md">
          <Text size="lg" fw={600} mb="md">
            Year-by-Year Projection
          </Text>

          <ScrollArea type="auto" offsetScrollbars>
            <Table striped highlightOnHover withTableBorder>
              <Table.Thead>
                <Table.Tr>
                  <Table.Th style={{ minWidth: 80 }}>Year</Table.Th>
                  <Table.Th style={{ minWidth: 60 }}>Age</Table.Th>
                  <Table.Th style={{ minWidth: 130 }}>Start Balance</Table.Th>
                  <Table.Th style={{ minWidth: 130 }}>Growth</Table.Th>
                  <Table.Th style={{ minWidth: 130 }}>Spending</Table.Th>
                  <Table.Th style={{ minWidth: 130 }}>End Balance</Table.Th>
                </Table.Tr>
              </Table.Thead>
              <Table.Tbody>
                {rows.map((row) => (
                  <Table.Tr key={row.year}>
                    <Table.Td>
                      <Text size="sm" fw={500}>
                        {row.year}
                      </Text>
                    </Table.Td>
                    <Table.Td>
                      <Text size="sm">{row.age}</Text>
                    </Table.Td>
                    <Table.Td>
                      <Text size="sm" style={{ fontFamily: 'monospace' }}>
                        {formatCurrency(row.startingBalance)}
                      </Text>
                    </Table.Td>
                    <Table.Td>
                      <Badge
                        color={row.growth >= 0 ? 'green' : 'red'}
                        variant="light"
                        size="sm"
                      >
                        {row.growth >= 0 ? '+' : ''}
                        {formatCurrency(row.growth)}
                      </Badge>
                    </Table.Td>
                    <Table.Td>
                      <Text size="sm" c="red" style={{ fontFamily: 'monospace' }}>
                        -{formatCurrency(row.spending)}
                      </Text>
                    </Table.Td>
                    <Table.Td>
                      <Text size="sm" fw={600} style={{ fontFamily: 'monospace' }}>
                        {formatCurrency(row.endingBalance)}
                      </Text>
                    </Table.Td>
                  </Table.Tr>
                ))}
              </Table.Tbody>
            </Table>
          </ScrollArea>

          <Text size="xs" c="dimmed" mt="xs" ta="center">
            {points.length} years projected
          </Text>
        </Paper>
      );
    }
    ```

    Key features:
    - Uses useChartData hook (same as chart) for synchronization
    - ScrollArea wrapper for mobile responsiveness
    - Striped rows and hover highlighting for readability
    - Badge component for growth values (green/red coloring)
    - Monospace font for currency alignment
    - Empty state matching chart behavior

  </action>
  <verify>Component renders with mock data and displays all columns correctly</verify>
  <done>ProjectionTable exists with all 6 columns, ScrollArea wrapper, formatted currency, and empty state</done>
</task>

<task type="auto">
  <name>Task 2: Create table components index</name>
  <files>src/components/tables/index.ts</files>
  <action>
    Create src/components/tables/index.ts:

    ```typescript
    export { ProjectionTable } from './ProjectionTable';
    ```

    This follows the same barrel export pattern used in src/components/charts/index.ts.

  </action>
  <verify>Index file exists and exports ProjectionTable</verify>
  <done>Barrel export file created</done>
</task>

<task type="auto">
  <name>Task 3: Add responsive styling and test</name>
  <files>src/components/tables/ProjectionTable.tsx</files>
  <action>
    Enhance ProjectionTable with additional responsive improvements:

    1. Add responsive column visibility using Mantine's useMediaQuery:
    ```typescript
    import { useMediaQuery } from '@mantine/hooks';

    // In component:
    const isMobile = useMediaQuery('(max-width: 768px)');
    ```

    2. Conditionally show/hide less critical columns on mobile:
    - Desktop: Show all 6 columns
    - Mobile: Show Year, Age, End Balance (hide Start, Growth, Spending)

    Update the table header:
    ```typescript
    <Table.Thead>
      <Table.Tr>
        <Table.Th style={{ minWidth: 80 }}>Year</Table.Th>
        <Table.Th style={{ minWidth: 60 }}>Age</Table.Th>
        {!isMobile && (
          <>
            <Table.Th style={{ minWidth: 130 }}>Start Balance</Table.Th>
            <Table.Th style={{ minWidth: 130 }}>Growth</Table.Th>
            <Table.Th style={{ minWidth: 130 }}>Spending</Table.Th>
          </>
        )}
        <Table.Th style={{ minWidth: 130 }}>End Balance</Table.Th>
      </Table.Tr>
    </Table.Thead>
    ```

    And update the row rendering similarly.

    3. Add test file src/components/tables/ProjectionTable.test.tsx:
    ```typescript
    import { render, screen } from '@testing-library/react';
    import { ProjectionTable } from './ProjectionTable';
    import { vi } from 'vitest';

    vi.mock('@/hooks/useChartData', () => ({
      useChartData: () => ({
        points: [
          {
            year: 2024,
            age: 30,
            netWorth: 100000,
            startingBalance: 95000,
            growth: 15000,
            spending: 10000,
            endingBalance: 100000,
          },
          {
            year: 2025,
            age: 31,
            netWorth: 108000,
            startingBalance: 100000,
            growth: 18000,
            spending: 10000,
            endingBalance: 108000,
          },
        ],
        minNetWorth: 100000,
        maxNetWorth: 108000,
        years: 2,
      }),
    }));

    describe('ProjectionTable', () => {
      it('renders table title', () => {
        render(<ProjectionTable />);
        expect(screen.getByText('Year-by-Year Projection')).toBeInTheDocument();
      });

      it('displays year count', () => {
        render(<ProjectionTable />);
        expect(screen.getByText('2 years projected')).toBeInTheDocument();
      });

      it('shows formatted currency values', () => {
        render(<ProjectionTable />);
        // Check for formatted currency (exact format may vary by locale)
        expect(screen.getByText('$100,000')).toBeInTheDocument();
      });

      it('renders correct number of rows', () => {
        render(<ProjectionTable />);
        const rows = screen.getAllByRole('row');
        // Header row + 2 data rows
        expect(rows.length).toBe(3);
      });
    });
    ```

    4. Run tests and verify:
    ```bash
    npm test -- ProjectionTable.test.tsx
    ```

  </action>
  <verify>All tests pass and TypeScript compiles without errors</verify>
  <done>Responsive styling added, columns hide on mobile, tests pass</done>
</task>

<task type="auto">
  <name>Task 4: Update main App to display chart and table</name>
  <files>src/App.tsx</files>
  <action>
    Update src/App.tsx to include both the NetWorthChart and ProjectionTable:

    ```typescript
    import { Container, Stack, Title } from '@mantine/core';
    import { NetWorthChart } from '@/components/charts';
    import { ProjectionTable } from '@/components/tables';

    function App() {
      return (
        <Container size="lg" py="xl">
          <Title order={1} mb="xl" ta="center">
            Open Finance Planner
          </Title>

          <Stack gap="xl">
            <NetWorthChart />
            <ProjectionTable />
          </Stack>
        </Container>
      );
    }

    export default App;
    ```

    Note: This assumes App.tsx exists from Phase 16. If not, create it.

    Also verify the components are exported correctly by checking imports work:
    ```bash
    npx tsc --noEmit
    ```

  </action>
  <verify>App.tsx imports and renders both components without TypeScript errors</verify>
  <done>App.tsx updated to display chart and table together</done>
</task>

</tasks>

<verification>
1. Table renders with all projection years
2. Columns: Year, Age, Start Balance, Growth, Spending, End Balance
3. Currency values formatted correctly
4. Growth displayed with color-coded badge (green for positive, red for negative)
5. Table scrolls horizontally on mobile
6. Table updates when simulation results change
7. Empty state displays when no data
8. All tests pass
9. TypeScript compiles without errors
</verification>

<success_criteria>

- ProjectionTable displays year-by-year projection data
- All 6 columns visible on desktop, simplified view on mobile
- Currency values formatted with formatCurrency utility
- Growth values shown as color-coded badges
- Table scrolls horizontally on mobile devices
- Synchronized with chart via useChartData hook
- Empty state handled gracefully
- Component exported from tables/index.ts
- TypeScript compiles without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/17-data-visualization/17-03-SUMMARY.md`
</output>
